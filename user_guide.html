<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Instructions for using nbstata as a Jupyter kernel">

<title>User Guide – nbstata</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-eedb13606a6330805a7e0830f38915ca.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1XLFCC9FMF"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
 
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied'
  });
gtag('config', 'G-1XLFCC9FMF', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="User Guide – nbstata">
<meta property="og:description" content="Instructions for using nbstata as a Jupyter kernel">
<meta property="og:image" content="https://hugetim.github.io/nbstata/images/status example.png">
<meta property="og:site_name" content="nbstata">
<meta property="og:image:alt" content="%status example">
<meta property="og:image:height" content="475">
<meta property="og:image:width" content="870">
<meta name="twitter:title" content="User Guide – nbstata">
<meta name="twitter:description" content="Instructions for using nbstata as a Jupyter kernel">
<meta name="twitter:image" content="https://hugetim.github.io/nbstata/images/status example.png">
<meta name="twitter:image:alt" content="%status example">
<meta name="twitter:image-height" content="475">
<meta name="twitter:image-width" content="870">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">nbstata</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hugetim/nbstata"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./user_guide.html">User Guide</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">nbstata: a new Stata kernel</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./user_guide.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">User Guide</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./dev_docs_index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Developer Docs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc_utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">misc_utils</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./config.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">config</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">stata</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stata_more.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">stata_more</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code_utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">code_utils</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./noecho.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">noecho</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./browse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">browse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stata_session.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">stata_session</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./magics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">magics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./completion_env.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">completion_env</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./completions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">completions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inspect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">inspect</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cell.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">cell</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kernel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">kernel</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">install</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link active" data-scroll-target="#getting-started">Getting Started</a>
  <ul class="collapse">
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites">Prerequisites</a></li>
  <li><a href="#install-nbstata" id="toc-install-nbstata" class="nav-link" data-scroll-target="#install-nbstata">Install <em>nbstata</em></a></li>
  <li><a href="#configuration-optional" id="toc-configuration-optional" class="nav-link" data-scroll-target="#configuration-optional">Configuration (optional)</a></li>
  <li><a href="#syntax-highlighting-optional" id="toc-syntax-highlighting-optional" class="nav-link" data-scroll-target="#syntax-highlighting-optional">Syntax highlighting (Optional)</a></li>
  <li><a href="#starting-jupyterlab" id="toc-starting-jupyterlab" class="nav-link" data-scroll-target="#starting-jupyterlab">Starting JupyterLab</a></li>
  </ul></li>
  <li><a href="#magics" id="toc-magics" class="nav-link" data-scroll-target="#magics">Magics</a>
  <ul class="collapse">
  <li><a href="#browse-head-tail-and-frame-equivalents" id="toc-browse-head-tail-and-frame-equivalents" class="nav-link" data-scroll-target="#browse-head-tail-and-frame-equivalents"><code>%browse</code>, <code>%head</code>, <code>%tail</code> (and frame equivalents)</a></li>
  <li><a href="#locals" id="toc-locals" class="nav-link" data-scroll-target="#locals"><code>%locals</code></a></li>
  <li><a href="#delimit" id="toc-delimit" class="nav-link" data-scroll-target="#delimit"><code>%delimit</code></a></li>
  <li><a href="#help" id="toc-help" class="nav-link" data-scroll-target="#help"><code>%help</code></a></li>
  <li><a href="#set-set" id="toc-set-set" class="nav-link" data-scroll-target="#set-set"><code>%set</code>, <code>%%set</code></a></li>
  <li><a href="#status" id="toc-status" class="nav-link" data-scroll-target="#status"><code>%status</code></a></li>
  <li><a href="#echo-noecho-quietly" id="toc-echo-noecho-quietly" class="nav-link" data-scroll-target="#echo-noecho-quietly"><code>%%echo</code> <code>%%noecho</code>, <code>%%quietly</code></a></li>
  </ul></li>
  <li><a href="#stata-implementation-details" id="toc-stata-implementation-details" class="nav-link" data-scroll-target="#stata-implementation-details">Stata Implementation Details</a></li>
  <li><a href="#quarto-tips" id="toc-quarto-tips" class="nav-link" data-scroll-target="#quarto-tips">Quarto tips</a>
  <ul class="collapse">
  <li><a href="#inline-calculations" id="toc-inline-calculations" class="nav-link" data-scroll-target="#inline-calculations">Inline calculations</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/hugetim/nbstata/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">User Guide</h1>
</div>

<div>
  <div class="description">
    Instructions for using nbstata as a Jupyter kernel
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<p>It doesn’t take much to get <em>nbstata</em> up and running. Here’s how:</p>
<section id="prerequisites" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites">Prerequisites</h3>
<section id="stata" class="level4">
<h4 class="anchored" data-anchor-id="stata">Stata</h4>
<p>Because <em>nbstata</em> uses <a href="https://www.stata.com/python/pystata18/">pystata</a> under the hood, a currently-licensed version of Stata 17+ must already be installed. <em>(If you have an older version of Stata, consider <a href="https://github.com/kylebarron/stata_kernel">stata_kernel</a> instead.)</em></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Stata troubleshooting (particularly for Arch Linux)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Make sure that the <code>stata</code> command (that is, the CLI to Stata, not to be confused with <code>xstata</code>, which is the GUI) works, otherwise <em>nbstata</em> won’t work.</p>
<p>In particular, if you are on Arch Linux and you get this error when running <code>stata</code>:</p>
<pre><code>stata: error while loading shared libraries: libncurses.so.5: cannot open shared object file: No such file or directory</code></pre>
<p>You need to install <a href="https://aur.archlinux.org/packages/ncurses5-compat-libs">ncurses5-compat-libs</a> from the AUR to fix it.</p>
</div>
</div>
</div>
</section>
<section id="python" class="level4">
<h4 class="anchored" data-anchor-id="python">Python</h4>
<p>In order to install the kernel, you will also need Python 3.10 or higher.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>nbstata Python and Stata version compatibility
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Stata 17 users can run <em>nbstata</em> under Python 3.10, 3.11, 3.12, and 3.13 but not under Python 3.14.</li>
<li>Stata 18, 18.5, 19, and 19.5 users can run <em>nbstata</em> under Python 3.10, 3.11, 3.12, 3.13, and 3.14. For Python 3.14, users need to update their version of Stata to the 12 November 2025 revision (or later). To see your version of Stata’s revision date issue in Stata, run either <code>about</code> or <code>display c(born_date)</code>.</li>
</ul>
</div>
</div>
</div>
<p>If are new to Python, I suggest installing the <a href="https://www.anaconda.com/download/">Anaconda distribution</a>. This doesn’t require administrator privileges and is the simplest way to install Python, JupyterLab and many of the most popular scientific packages.</p>
<p>(However, the full Anaconda installation is quite large, and it includes many libraries for Python that <em>nbstata</em> doesn’t use. If you don’t plan to use Python and want to use less disk space, install <a href="https://conda.io/miniconda.html">Miniconda</a>, a bare-bones version of Anaconda. Then, at an Anaconda prompt, type <code>conda install jupyterlab</code> to install JupyterLab.)</p>
<p>The remainder of this guide assumes you have a Anaconda installed, but all you really need is Python and JupyterLab (or some other way of making use of the Stata kernel, such as <a href="#Quarto-tips">Quarto</a>).</p>
</section>
</section>
<section id="install-nbstata" class="level3">
<h3 class="anchored" data-anchor-id="install-nbstata">Install <em>nbstata</em></h3>
<p>To download and install the python package run the following at an Anaconda prompt:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install nbstata</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Next run the Stata kernel install script, which has the following syntax (with square brackets denoting options):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> nbstata.install <span class="pp">[--</span><span class="ss">sys</span><span class="pp">-</span><span class="ss">prefix</span><span class="pp">]</span> [--prefix PREFIX] <span class="pp">[--</span><span class="ss">conf</span><span class="pp">-</span><span class="ss">file</span><span class="pp">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>That is, the most basic kernel install command is just <code>python -m nbstata.install</code>. The options are explained in the next section.</p>
<section id="kernel-setup-options" class="level4">
<h4 class="anchored" data-anchor-id="kernel-setup-options">Kernel setup options</h4>
<p>Include <code>--sys-prefix</code> to install the kernel to <code>sys.prefix</code> (e.g.&nbsp;a virtualenv or conda env), or <code>--prefix PREFIX</code> if you want to specify the install path yourself (typing it in place of <code>PREFIX</code>).</p>
<p>The <code>--conf-file</code> option creates a configuration file for you. (Note: A configuration file will always be created if the installer cannot locate your Stata installation.)</p>
<p>The location of the configuration file will be:</p>
<ul>
<li><code>[sys.prefix]/etc/nbstata.conf</code> if <code>--sys-prefix</code> or <code>--prefix</code> is specified.</li>
<li><code>~/.config/nbstata/nbstata.conf</code> otherwise.</li>
</ul>
<p>(If a configuration file exists in both locations at kernel runtime, the home directory (<code>~</code>) version takes precedence. For backwards compatibility, config files saved to <code>~/.nbstata.conf</code> also work. When in doubt, the <a href="#status">%status magic</a> indicates the location of the operative config file.)</p>
</section>
<section id="updating" class="level4">
<h4 class="anchored" data-anchor-id="updating">Updating</h4>
<p>To upgrade from a previous version of <em>nbstata</em>, run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install nbstata <span class="at">--upgrade</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>When updating, you don’t have to run <code>python -m nbstata.install</code> again.</p>
</section>
</section>
<section id="configuration-optional" class="level3">
<h3 class="anchored" data-anchor-id="configuration-optional">Configuration (optional)</h3>
<p>The following settings are permitted inside the <a href="#kernel-setup-options">configuration file</a>. Aside from the first three, they may also be set within your notebook using the <a href="#set-set">%set magic explained below</a>):</p>
<ul>
<li><code>stata_dir</code>: Stata installation directory.</li>
<li><code>edition</code>: Stata edition. Acceptable values are ‘be’, ‘se’ and ‘mp’. Default is ‘be’.</li>
<li><code>splash</code>: controls display of the splash message during Stata startup. Default is ‘False’.</li>
<li><code>graph_format</code>: Acceptable values are ‘png’ (the default), ‘pdf’, ‘svg’ and ‘pystata’. Specify the last option if you want to use <code>pystata</code>’s <a href="https://www.stata.com/python/pystata18/config.html#pystata.config.set_graph_format">default setting</a>.</li>
<li><code>graph_width</code>/<code>graph_height</code>: By default, graphs are generated with width 5.5in and height 4in. The width or height may be specified as a number (interpreted as inches) or a number and its unit (in, cm, or px). So <code>3</code> and <code>3in</code> are equivalent. Other valid examples: <code>300px</code> and <code>7.2 cm</code>. (Note: These values may also be set to <code>default</code>, which values alone enable the <code>xsize</code> and <code>ysize</code> options on Stata graph commands to influence the graph output size. Any values other than <code>default</code> override the <code>xsize</code> and <code>ysize</code> options.)</li>
<li><code>echo</code>: controls the echo of commands, with the default being ‘None’:
<ul>
<li>‘True’: echo all commands.</li>
<li>‘False’: for Stata 18.5+, not echo any command (native Stata implementation); otherwise echo only multi-line commands.</li>
<li>‘None’: not echo any command (custom nbstata implementation).</li>
</ul></li>
<li><code>missing</code>: What to display for a missing value in the output of the <code>%browse</code>, <code>%head</code>, and <code>%tail</code> magics. Default is ‘.’, following Stata. To defer to pandas’s format for <code>NaN</code>, specify ‘pandas’.</li>
<li><code>browse_auto_height</code>: Whether to set ‘height: 100%’ for the <a href="#browse-head-tail-and-frame-equivalents">%browse</a> widget (default: ‘True’):
<ul>
<li>‘True’: allows browse widget to expand to height of its container, such as when using ‘Create New View for Output’ in Jupyter Lab.</li>
<li>‘False’: fixed height of around 22 rows, recommended for NBClassic and VSCode.</li>
</ul></li>
</ul>
<p>Settings must be under the title <code>[nbstata]</code>. Not all settings need be included. Example:</p>
<pre><code>[nbstata]
stata_dir = /opt/stata
splash = True
graph_format = pystata
graph_width = default
graph_height = default
echo = False</code></pre>
<p><strong>Default Graph Format</strong></p>
<p>Both <em>pystata</em> and <em>stata_kernel</em> default to the SVG image format. <em>nbstata</em> (like <em>pystata-kernel</em>) defaults to the PNG image format instead for several reasons:</p>
<ul>
<li>Jupyter does not show SVG images from untrusted notebooks (<a href="https://stackoverflow.com/questions/68398033/svg-figures-hidden-in-jupyterlab-after-some-time">link 1</a>).</li>
<li>Notebooks with empty cells are untrusted (<a href="https://github.com/jupyterlab/jupyterlab/issues/9765">link 2</a>).</li>
<li>SVG images cannot be copied and pasted directly into Word or PowerPoint.</li>
</ul>
</section>
<section id="syntax-highlighting-optional" class="level3">
<h3 class="anchored" data-anchor-id="syntax-highlighting-optional">Syntax highlighting (Optional)</h3>
<p>Stata syntax highlighting can be installed for Jupyter Lab:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install jupyterlab_stata_highlight2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>(If you prefer the standard Jupyter color scheme, the original <a href="https://kylebarron.dev/stata_kernel/using_jupyter/lab/#syntax-highlighting">jupyterlab-stata-highlight</a> also works.)</p>
</section>
<section id="starting-jupyterlab" class="level3">
<h3 class="anchored" data-anchor-id="starting-jupyterlab">Starting JupyterLab</h3>
<p>You can start JupyterLab from within Anaconda Navigator. Or start it from an Anaconda prompt by running:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jupyter</span> lab</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Either should open it up in a new browser tab. From there, you can create a new Stata notebook.</p>
<p>Note: By default, you can only open/save notebooks within the directory from which JupyterLab is run. To access a different directory, you can instead start it up by running:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jupyter</span> lab <span class="at">--notebook-dir</span> <span class="st">"YOUR_PATH_HERE"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="magics" class="level2">
<h2 class="anchored" data-anchor-id="magics">Magics</h2>
<p>‘Magics’ are commands provided by <em>nbstata</em> that enhance the experience of working with Stata in Jupyter. They work only when placed at the beginning of a code cell.</p>
<p>Jupyter magics typically start with <code>%</code>, but <em>nbstata</em> magics may alternatively be prefixed with <code>*%</code> so that, if you export a Stata notebook to a .do file and run it that way, the magics will not cause errors.</p>
<p><em>nbstata</em> currently supports the following magics:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Magic</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Full Syntax</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">%browse</td>
<td style="text-align: left;">Interactively view dataset</td>
<td style="text-align: left;"><code>%browse [-h] [varlist] [if] [in] [, nolabel noformat]</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">%head</td>
<td style="text-align: left;">View first 5 (or N) rows</td>
<td style="text-align: left;"><code>%head [-h] [N] [varlist] [if] [, nolabel noformat]</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">%tail</td>
<td style="text-align: left;">View last 5 (or N) rows</td>
<td style="text-align: left;"><code>%tail [-h] [N] [varlist] [if] [, nolabel noformat]</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">%frbrowse</td>
<td style="text-align: left;">Interactively view frame</td>
<td style="text-align: left;"><code>%frbrowse [-h] framename[: [varlist] [if] [in] [, nolabel noformat]]</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">%frhead</td>
<td style="text-align: left;">View first 5 (or N) frame rows</td>
<td style="text-align: left;"><code>%frhead [-h] framename[: [N] [varlist] [if] [, nolabel noformat]]</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">%frtail</td>
<td style="text-align: left;">View last 5 (or N) frame rows</td>
<td style="text-align: left;"><code>%frtail [-h] framename[: [N] [varlist] [if] [, nolabel noformat]]</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">%locals</td>
<td style="text-align: left;">List locals with their values</td>
<td style="text-align: left;"><code>%locals</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">%delimit</td>
<td style="text-align: left;">Print the current delimiter</td>
<td style="text-align: left;"><code>%delimit</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">%help</td>
<td style="text-align: left;">Display Stata help</td>
<td style="text-align: left;"><code>%help [-h] command_or_topic_name</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">%set</td>
<td style="text-align: left;">Set single config option</td>
<td style="text-align: left;"><code>%set [-h] key = value</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">%%set</td>
<td style="text-align: left;">Set multiple config options</td>
<td style="text-align: left;"><code>%%set [-h]</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">%status</td>
<td style="text-align: left;">Display Stata/config status</td>
<td style="text-align: left;"><code>%status</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">%%echo</td>
<td style="text-align: left;">Ensure echo from cell</td>
<td style="text-align: left;"><code>%%echo</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">%%noecho</td>
<td style="text-align: left;">Suppress echo from cell</td>
<td style="text-align: left;"><code>%%noecho</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">%%quietly</td>
<td style="text-align: left;">Suppress all output from cell</td>
<td style="text-align: left;"><code>%%quietly</code></td>
</tr>
</tbody>
</table>
<p>You can run any magic with the <code>-h</code> option (<code>--help</code>) to see brief help documentation for the magic.</p>
<section id="browse-head-tail-and-frame-equivalents" class="level3">
<h3 class="anchored" data-anchor-id="browse-head-tail-and-frame-equivalents"><code>%browse</code>, <code>%head</code>, <code>%tail</code> (and frame equivalents)</h3>
<p><em>Quickly view your data</em></p>
<pre><code>*%browse [-h] [varlist] [if] [in] [, nolabel noformat]
*%head [-h] [N] [varlist] [if] [, nolabel noformat]
*%tail [-h] [N] [varlist] [if] [, nolabel noformat]</code></pre>
<p>These magics provide alternatives to Stata’s <code>browse</code> command, which is not available in a Stata notebook. They can each be called with standard Stata <code>varlist</code> and <code>if</code> syntax. <code>%browse</code> also supports Stata’s <code>in</code> syntax, whereas <code>%head</code> (and <code>%tail</code>), modeled after <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.head.html">pandas</a>, display the first (or last) 5 (or <code>N</code>) observations that meet the (optional) <code>if</code> criteria.</p>
<p>By default, the <code>%browse</code>, <code>%head</code>, and <code>%tail</code> magics convert numeric Stata values to strings using their Stata format and value labels. To prevent this behavior, specify the <code>noformat</code> and/or <code>nolabel</code> options.</p>
<p>The output of any of these, but especially that of <code>%browse</code>, may be expanded into a separate Jupyter Lab tab by right clicking it and selecting “Create New View for Output.”</p>
<p><code>%frbrowse</code>, <code>%frhead</code>, and <code>%frtail</code> do the same for a frame specified as a prefix. Examples:</p>
<pre><code>%frbrowse alt_frame
%frhead alt_frame: if var1 == 1, nolabels</code></pre>
</section>
<section id="locals" class="level3">
<h3 class="anchored" data-anchor-id="locals"><code>%locals</code></h3>
<p><em>List local macro names and values</em></p>
<p>This takes no arguments. The output format mimics Stata’s <code>macro list</code> command (which only displays global macros).</p>
</section>
<section id="delimit" class="level3">
<h3 class="anchored" data-anchor-id="delimit"><code>%delimit</code></h3>
<p><em>Print the current Stata command delimiter</em></p>
<p>This takes no arguments; it prints the delimiter currently set: either <code>cr</code> or <code>;</code>. If you want to change the delimiter, use <code>#delimit ;</code> or <code>#delimit cr</code>. The delimiter will remain set until changed.</p>
<pre><code>[1]: %delimit
Current Stata command delimiter: cr
[2]: #delimit ;
delimiter now ;
[3]: *%delimit
Current Stata command delimiter: ;
[4]: #delimit cr
delimiter now cr</code></pre>
</section>
<section id="help" class="level3">
<h3 class="anchored" data-anchor-id="help"><code>%help</code></h3>
<p><em>Display a help file in rich text</em></p>
<pre><code>*%help [-h] command_or_topic_name</code></pre>
<p>Add the term you want to search for after <code>%help</code>. For example:</p>
<p><img align="center" width="650" src="https://github.com/kylebarron/stata_kernel/raw/master/docs/src/img/notebook_help_magic.png" alt="Jupyter Notebook help example"></p>
<p>The underlined terms in the output are <em>links</em>. Click on them to open further help in a new tab.</p>
</section>
<section id="set-set" class="level3">
<h3 class="anchored" data-anchor-id="set-set"><code>%set</code>, <code>%%set</code></h3>
<p><em>Set configuration values</em></p>
<p>Usage:</p>
<pre><code>*%set [-h] key = value</code></pre>
<pre><code>*%%set
key1 = value1
[key2 = value2]
[...]</code></pre>
<ul>
<li><code>key</code>: Configuration setting name: <code>graph_format</code>, <code>graph_width</code>, <code>graph_height</code>, <code>echo</code>, or <code>missing</code></li>
<li><code>value</code>: Value to set. See <a href="#configuration-optional">Configuration</a> above for more information.</li>
</ul>
<p>Examples:</p>
<pre><code>*%set graph_format = svg</code></pre>
<pre><code>%%set
echo = True
missing = N/A</code></pre>
<p>To prevent the cell magic <code>%%set</code> from causing an error if you export the notebook to a .do file and run it that way, you may surround the key-value statements with <code>/*</code> and <code>*/</code> on separate lines, like this:</p>
<pre><code>*%%set
/*
echo = True
missing = N/A
*/</code></pre>
</section>
<section id="status" class="level3">
<h3 class="anchored" data-anchor-id="status"><code>%status</code></h3>
<p><em>Display Stata status and configuration values</em></p>
<p><img align="center" width="500" src="images/status example.png" alt="%status example"></p>
</section>
<section id="echo-noecho-quietly" class="level3">
<h3 class="anchored" data-anchor-id="echo-noecho-quietly"><code>%%echo</code> <code>%%noecho</code>, <code>%%quietly</code></h3>
<p><em>Toggle cell output type</em></p>
<p>Putting <code>%%echo</code> at the top of a cell sets the configuration option <code>echo = True</code> <em>for just that cell</em>. For example, suppose you have configured <code>echo = None</code> but you do want to see the Stata commands echoed for a particular cell:</p>
<pre><code>[1]: *%%echo
     disp 1
     disp 2
. disp 1
1

. disp 2
2

. 
</code></pre>
<p>Similarly, <code>%%noecho</code> sets the configuration option <code>echo = None</code> for a single cell:</p>
<pre><code>[2]: *%%noecho
     disp 1
     disp 2
1
2</code></pre>
<p><code>%%quietly</code> silences all cell output, including graphs. It is a convenience magic equivalent to placing the standard Stata code <code>quietly {</code> at the start and <code>}</code> at the end of the cell.</p>
<pre><code>[3]: *%%quietly
     disp 1
     disp 2</code></pre>
</section>
</section>
<section id="stata-implementation-details" class="level2">
<h2 class="anchored" data-anchor-id="stata-implementation-details">Stata Implementation Details</h2>
<section id="delimit-behavior" class="level4">
<h4 class="anchored" data-anchor-id="delimit-behavior"><code>#delimit</code> behavior</h4>
<p>A <a href="https://www.stata.com/manuals/pdelimit.pdf"><code>#delimit;</code></a> command in one cell will persist into other cells, until <code>#delimit cr</code> is called. For example, see <a href="https://github.com/hugetim/nbstata/blob/master/manual_test_nbs/delimit%20tests.ipynb">delimit tests.ipynb</a>.</p>
</section>
<section id="echo-none-potential-for-unanticipated-errors" class="level4">
<h4 class="anchored" data-anchor-id="echo-none-potential-for-unanticipated-errors"><code>echo = None</code>: potential for unanticipated errors</h4>
<p>With Stata 18.5+, <code>echo = False</code> is recommended.</p>
<p>The default <code>echo = None</code> configuration does some complicated things under the hood to emulate functionality that <em>pystata</em> does not directly support: running multi-line Stata code without echoing the commands. While extensive automatic tests are in place to help ensure its reliability, unanticipated issues may arise. If, while using this mode, a particular code cell is not working as expected, try placing the <code>%%echo</code> magic at the top of it to see if that resolves the issue. (If so, please report that <a href="https://github.com/hugetim/nbstata/issues/new?labels=bug">here</a>.) You can also avoid such potential issues by setting the config <code>echo = False</code>, which will at least not echo single-line Stata commands though it will echo multiple commands for Stata 17 and 18.0.</p>
</section>
<section id="more-and-pause" class="level4">
<h4 class="anchored" data-anchor-id="more-and-pause"><code>more</code> and <code>pause</code></h4>
<p>Stata’s <a href="https://www.stata.com/help.cgi?more">more</a> and <a href="https://www.stata.com/help.cgi?pause">pause</a> commands do not work in a notebook, so these features should remain in their default ‘off’ states (i.e., <code>set more off</code> and <code>pause off</code>).</p>
</section>
<section id="linesize" class="level4">
<h4 class="anchored" data-anchor-id="linesize">linesize</h4>
<p>Unlike in the official Stata interface, the width of Stata output will not automatically adjust to the width of your window. Instead, you can use the <a href="https://www.stata.com/help.cgi?linesize">set linesize</a> Stata command to change it manually. For example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">linesize</span> 130</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="quarto-tips" class="level2">
<h2 class="anchored" data-anchor-id="quarto-tips">Quarto tips</h2>
<p><em>nbstata</em> can be used with <a href="https://quarto.org/">Quarto</a>, starting from either a notebook or a .qmd markdown file, to create output in a wide variety of formats. Just include <code>jupyter: nbstata</code> in the document-level YAML at the top and use <code>*|</code> as the prefix for cell options.</p>
<section id="inline-calculations" class="level3">
<h3 class="anchored" data-anchor-id="inline-calculations">Inline calculations</h3>
<p>With nbstata v0.8+, you can use the standard Quarto syntax for <a href="https://quarto.org/docs/computations/inline-code.html">inline code</a>, specifying the Stata expression as ‘[%<em>fmt</em>] <em>exp</em>’, just as you would for a Stata <a href="https://www.stata.com/help.cgi?display"><code>display</code> command</a>. For example:</p>
<pre class="qmd"><code>```{stata}
*| include: False
sysuse auto, clear
regress price mpg
```
An *increase* of one mpg is associated with a *decrease* in price of \$`{stata} %5.2f abs(_b[mpg])`.</code></pre>
<p>would result in output like this:</p>
<blockquote class="blockquote">
<p>An <em>increase</em> of one mpg is associated with a <em>decrease</em> in price of $238.89.</p>
</blockquote>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Stata locals cannot be referenced within inline code like `x’ because the tick (or “left single quote,” as Stata’s manual calls it) conflicts with Quarto’s inline code syntax. You can instead use globals or scalars to pass things to inline code.</p>
<p>For example, this gives the same output as above (whereas defining ‘mpg_coef’ as a local would not work):</p>
<pre class="qmd"><code>```{stata}
*| include: False
scalar mpg_coef = string(abs(_b[mpg]), "%5.2f")
```
An *increase* of one mpg is associated with a *decrease* in price of \$`{stata} mpg_coef`.</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/hugetim\.github\.io\/nbstata");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link" aria-label="nbstata: a new Stata kernel">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">nbstata: a new Stata kernel</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/hugetim/nbstata/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>